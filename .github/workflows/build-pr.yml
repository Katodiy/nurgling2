name: Build PR

on:
  pull_request:
    branches: [master]
    paths-ignore:
      - '*.md'
      - 'docs/**'

env:
  JAVA_VERSION: '17'

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'

      - name: Cache external libraries
        uses: actions/cache@v4
        with:
          path: lib/ext
          key: extlibs-${{ runner.os }}-${{ hashFiles('build.xml') }}
          restore-keys: |
            extlibs-${{ runner.os }}-

      - name: Build with Ant
        run: ant jar

      - name: Verify build
        shell: pwsh
        run: |
          if (!(Test-Path "build/hafen.jar")) {
            Write-Error "Build failed - hafen.jar not found"
            exit 1
          }
          $size = (Get-Item "build/hafen.jar").Length / 1MB
          Write-Host "Build successful! hafen.jar size: $([math]::Round($size, 2)) MB"
